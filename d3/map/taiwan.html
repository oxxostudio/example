<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>2016 台灣各縣市民進黨總統票得票率</title>
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="//d3js.org/topojson.v1.min.js"></script>
  <style>
  #show{
  	position:absolute;
  	z-index:100;
  	top:0;
  	left:0;
  	pointer-events: none;
  	font-size:12px;
  }
  #show:before{
  	position:absolute;
  	content: attr(data-show);
  	top:0;
  	left:0;
  	background:rgba(255,255,255,.7);
  	white-space:nowrap;
  	padding:5px;
  }
  .subunit:hover{
  	transition:.3s;
  	fill:#f80!important;
  }
  </style>
</head>

<body>
<div id="show"></div>
</body>
<script>
var rate = {
  '臺北市': 51.96,
  '新北市': 54.79,
  '基隆市': 48.22,
  '宜蘭縣': 62.06,
  '桃園市': 51.03,
  '新竹縣': 42.52,
  '新竹市': 51.22,
  '苗栗縣': 45.45,
  '臺中市': 55.01,
  '彰化縣': 56.47,
  '南投縣': 52.23,
  '雲林縣': 63.41,
  '嘉義縣': 65.37,
  '嘉義市': 59.86,
  '臺南市': 67.52,
  '高雄市': 63.39,
  '屏東縣': 63.49,
  '臺東縣': 38.42,
  '花蓮縣': 36.94,
  '澎湖縣': 50.81,
  '金門縣': 18.00,
  '連江縣': 16.54
};

var width = 960,
  height = 1160;

var path = d3.geo.path().projection( // 路徑產生器
  d3.geo.mercator().center([121, 24]).scale(6000) // 座標變換函式
);

var svg = d3.select("body").append("svg")
  .attr("width", width)
  .attr("height", height);

d3.json("map.json", function(error, taiwan) {

  var county = topojson.feature(taiwan, taiwan.objects["County_MOI_1041215"]).features;

  console.log(county);

  svg.selectAll(".subunit")
    .data(county)
    .enter().append("path")
    .attr("class", function(d) {
      return "subunit " + "a" + d.properties.County_ID;
    })
    .attr("d", path);


  for (var i = 0; i < county.length; i++) {
    var name = county[i].properties.C_Name;
    var rateNum = rate[name];
    var className = 'a' + county[i].properties.County_ID;
    var color = 'rgba(0,'+Math.floor(rateNum / 100 * 255)+','+(255-Math.floor(rateNum / 100 * 255))+',1)';
    county[i].properties.rate = rateNum;
    console.log(rateNum, name, className, color);
    d3.selectAll('.' + className)
	    .attr("data-show", function(d) {
	      return name+'，得票率：'+rateNum+'%';
	    })
      .style({
        'fill': color
      })
      .on('mouseover',function() {
      	var nn = d3.select(this).attr('data-show');
        d3.select('#show')
			    .attr("data-show", function(d) {
			      return nn;
			    })
      })
      .on('mouseout',function() {
        d3.select('#show')
			    .attr("data-show", function(d) {
			      return '';
			    })
      });
  }

  var mouseX, mouseY;
  var show = document.getElementById('show');
  window.onmousemove = function(e){
  	mouseX = e.pageX;
  	mouseY = e.pageY;
  	show.style.top = mouseY+'px';
  	show.style.left = mouseX+10+'px';
  };

});
</script>

</html>
