<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>google map dht</title>
  <script src="https://webduino.io/components/webduino-js/dist/webduino-all.min.js"></script>
  <script src="https://blockly.webduino.io/webduino-blockly.js"></script>
  <style>
  html,
  body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
  
  #map {
    width: 100%;
    height: 100%;
  }
  
  .mapMarker {
    line-height: 20px;
  }
  
  .mapMarker h3 {
    margin: 5px 0 8px 0;
    padding: 5px 0 8px 0;
    border-bottom: 1px solid #ccc;
  }

  </style>
</head>

<body>
  <div id="map"></div>
  <script type="text/javascript">
  var key = 'AIzaSyB6TBwRrd2pQeyD0COblf4uADkO1EMjSCw';
  var center = "二聖公園";
  var zoom = 17;
  var z = 1;
  var map;

  function loadScript(url, callback) {

    var script = document.createElement("script")
    script.type = "text/javascript";

    script.onload = function() {
      callback();
    };

    script.src = url;
    document.getElementsByTagName("head")[0].appendChild(script);
  }

  loadScript('https://maps.googleapis.com/maps/api/js?key=' + key, gmap);

  function gmap() {

    initialize();

    function initialize() {
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: zoom
      });
      setCenter(center);
    }

    function setCenter(address) {
      var marker = new google.maps.Marker({
        map: map
      });
      geocoder = new google.maps.Geocoder();
      geocoder.geocode({
        address: address
      }, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          LatLng = results[0].geometry.location;
          map.setCenter(LatLng);
        }
      });
    }

    function GetAddressMarker(address, title, markerID) {
      z = z + 1;
      var marker = new google.maps.Marker({
        map: map,
        zIndex: z
      });
      geocoder = new google.maps.Geocoder();
      geocoder.geocode({
        address: address
      }, function(results, status) {
        if (status == google.maps.GeocoderStatus.OK) {
          LatLng = results[0].geometry.location;
          marker.setPosition(LatLng);
          console.log("lat:" + LatLng.lat() + ",lng:" + LatLng.lng());

          var infowindow = new google.maps.InfoWindow({
            content: '<div id="' + markerID + '" class="mapMarker" style="z-index:' + z + ';"><h3>' + title + '</h3><div class="markerContent"></div></div>'
          });

          infowindow.open(map, marker);
          marker.addListener('click', function() {
            infowindow.open(map, marker);
          });

        }
      });
    }

    GetAddressMarker('二聖公園', '二聖公園', 'a1');
    GetAddressMarker('英明國中', '英明國中', 'a2');
    GetAddressMarker('英明公園', '英明公園', 'a3');
  }
  </script>
</body>

</html>
